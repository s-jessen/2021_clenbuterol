---
title: "for"
format: html
editor: source
self-contained: true
---

Load libraries
```{r, include = FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE, error=FALSE)
source(here::here("R/libraries.R"))
source(here::here("R/colors.R"))
source(here::here("R/functions.R"))
```

Load data
```{r}
df <- readxl::read_excel(here::here('data-raw/clen_data.xlsx')) %>% 
    dplyr::mutate(id = as.factor(id)) %>% 
    dplyr::mutate(trial = as.numeric(trial)) %>%
    dplyr::mutate(time = factor(time, levels = c("pre", "post"))) %>%
    dplyr::mutate(treatment = factor(treatment, levels = c("PLA", "CLEN"))) %>%
    dplyr::group_by(id) %>% 
    dplyr::mutate(delta_lean_carry_over = lean - lean[trial == "1"]) %>%
    dplyr::ungroup() %>% 
    dplyr::group_by(id, treatment) %>% 
    dplyr::mutate(delta_lean = lean - lean[time == "pre"]) %>%
    dplyr::mutate(delta_fat = fat - fat[time == "pre"]) %>% 
    dplyr::mutate(delta_fat_p = fat_p - fat_p[time == "pre"]) %>% 
    dplyr::mutate(delta_vo2max = vo2max - vo2max[time == "pre"]) %>% 
    dplyr::mutate(delta_ippo = ippo - ippo[time == "pre"]) %>% 
    dplyr::mutate(delta_appo = appo - appo[time == "pre"]) %>% 
    dplyr::mutate(delta_ppo = ppo - ppo[time == "pre"]) %>%
    dplyr::mutate(delta_mpo = mpo - mpo[time == "pre"]) %>% 
    dplyr::mutate(delta_mvc = mvc - mvc[time == "pre"]) %>% 
    dplyr::mutate(delta_lv_mass = lv_mass - lv_mass[time == "pre"]) %>% 
    dplyr::mutate(delta_lv_sv = lv_sv - lv_sv[time == "pre"]) %>% 
    dplyr::mutate(delta_hr = hr - hr[time == "pre"]) %>% 
    dplyr::mutate(delta_co = co - co[time == "pre"]) %>% 
    dplyr::mutate(delta_ef = ef - ef[time == "pre"]) 
    
```

# Carry over
```{r}
df %>% 
    dplyr::filter(!is.na(start_treatment)) %>% 
    ggplot(aes(x = trial, y = delta_lean_carry_over))+
    stat_summary(aes(group = id), fun = "mean", geom = "line", size = 0.5, na.rm = TRUE, show.legend = FALSE, alpha = 0.8, color = "gray")+
    stat_summary(aes(group = start_treatment), fun = "mean", geom = "line", size = 0.5, na.rm = TRUE, show.legend = FALSE, color = "red")+
    geom_hline(yintercept = 0, linetype = "dashed", linewidth = 0.25)+
    theme(
        panel.background = element_blank(),
        panel.border = element_rect(colour = "black", fill=NA, linewidth = 0.1),
        panel.grid.minor=element_blank(),
        panel.grid.major = element_blank(),
        plot.background = element_rect(fill = "white"),
        axis.line = element_blank(),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1),
        axis.ticks = element_line(linewidth = 0.1),
        axis.title = element_text(size = 8, family="Source Sans Pro"),
        axis.title.x = element_text(size = 8, family="Source Sans Pro"),
        axis.title.y = element_text(size = 8, family="Source Sans Pro"),
        text = element_text(size = 10, family="Source Sans Pro"),
        legend.title = element_blank(),
        legend.key = element_blank(),
        strip.background = element_blank()
    )+
    labs(y = "Lean (difference to exp. trial 1)",
         x = "Experiment trial")+
    facet_grid(~start_treatment,
               labeller = as_labeller(c(CLEN = "Started w. CLEN",
                                      PLA = "Started w. PLA")))

ggsave(here::here('data/figures/carry_over.svg'), height = 100, width = 200, units = "mm")
```


# Lean
```{r}
lean <- barplot(df, variable = "delta_lean", ylab = "Change in lean mass (kg)")

ggsave(here::here('data/figures/lean.svg'), width = 60, height = 50, units = "mm")
```

# Fat
```{r}
fat <- barplot(df, variable = "delta_fat", ylab = "Change in fat mass (kg)")

ggsave(here::here('data/figures/fat.svg'), width = 60, height = 50, units = "mm")
```

# Fat percent
```{r}
fat_p <- barplot(df, variable = "delta_fat_p", ylab = "Change in fat percent (%.)")

ggsave(here::here('data/figures/fat_p.svg'), width = 60, height = 50, units = "mm")

```

# VO2max
```{r}
vo2max <- barplot(df, variable = "delta_vo2max", ylab = "Change in VO2max (mL/min)")

ggsave(here::here('data/figures/vo2max.svg'), width = 60, height = 50, units = "mm")

```

# iPPO
```{r}
ippo <- barplot(df, variable = "delta_ippo", ylab = "Change in Wmax (W)")

ggsave(here::here('data/figures/ippo.svg'), width = 60, height = 50, units = "mm")

```

# appo
```{r}
appo <- barplot(df, variable = "delta_appo", ylab = "Change in aerobic peak power (W)")

ggsave(here::here('data/figures/appo.svg'), width = 60, height = 50, units = "mm")

```

# MVC
```{r}
mvc <- barplot(df, variable = "delta_mvc", ylab = "Change in MVC (Nm)")

ggsave(here::here('data/figures/mvc.svg'), width = 60, height = 50, units = "mm")

```

# Sprint PPO
```{r}
ppo <- barplot(df, variable = "delta_ppo", ylab = "Change in PPO (W)")

ggsave(here::here('data/figures/ppo.svg'), width = 60, height = 50, units = "mm")

```

# Sprint MPO
```{r}
mpo <- barplot(df, variable = "delta_mpo", ylab = "Change in MPO (W)")

ggsave(here::here('data/figures/mpo.svg'), width = 60, height = 50, units = "mm")

```

